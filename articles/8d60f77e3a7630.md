---
title: "STARKの原理"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Blockchain", "数学"]
published: false
---

# STARKの概要
AliceはBobに、フィボナッチ数列の第$n$項は何々である、というステートメントを納得して欲しいという状況を考えてみましょう。ただし、Bobは性能の良いパソコンを持っておらず、フィボナッチ数列を直接計算することは不可能であるとします。この状況で、Bobにフィボナッチ数列の第$n$項が何であるか納得してもらうことは可能でしょうか？実は可能です。そう、~~iphone~~STARKならね。

STARKを用いると、手順は次のようになります。Aliceはフィボナッチ数列の第$n$項が何であるかの「証明」を作成してBobに渡します。Bobはこの「証明」を検証し、正しいか間違っているかを判断します。フィボナッチ数列の第$n$項を計算するのに必要な時間を$T$としたとき、Aliceは$\mathcal{O}(T \log T)$で「証明」を作成でき、Bobは$\mathcal{O}(\log T)$で「証明」を検証できます。

Aliceはステートメント(フィボナッチ数列の第$n$項は何々であるということ)を証明したいので証明者、Bobはそのステートメントを検証するので検証者と呼ぶことにします。

STARKは、Scalable Transparent ARgument of Knowledgeの略で、それぞれ

- Scalable: 元の計算時間を$T$としたとき、証明の生成時間は$\mathcal{O}(T \log T)$($T$に対して準線形的)であり、検証時間は$\mathcal{O}(\log T)$である。
- Transparent: Trusted setup(信頼できる第三者による事前のセットアップ)を必要としない
- ARgument of Knowledge: ある知識を知っていることの証明

を意味します。 類似の証明系であるSNARK(Succinct Non-interactive ARgument of Knowledge)と比べると、証明の生成時間が短く、trusted setupを必要としないという長所があります。一方で、一般的にSNARKよりも証明のサイズが大きく検証時間も$\mathcal{O}(\log T)$掛かってしまう(SNARKでは定数時間で検証できるものもある)という短所もあります。なおSNARKについて馴染みのない方は、[zk-SNARKsの原理](https://zenn.dev/qope/articles/f94b37ff2d9541)をご一読されることをおすすめします。

また、SNARKは任意の計算に適応できる一方、STARKは繰り返しの構造がある計算(forループを回し続けるようなもの)でないと非効率的になってしまうという問題もあります。一方で、そのような繰り返し構造のある計算においては、SNARKは回路サイズの上限を設定する必要がある一方、STARKは任意サイズの回路の証明を作成することができるため、STARKの方が適しています。

VM(仮想マシン)は状態遷移のforループで実装されており、またループの上限は存在しません。従ってSTARKはVMの証明に向いており、近年zkVMの文脈で注目を集めています。

## 証明の流れ
STARKの証明の流れを概観します(図)。ステートメントを証明するのに必要な中間状態(フィボナッチ数列の場合は、初項から第$n$項までの値)を$[a_0, \ldots, a_{n-1}]$とし、これを**trace**と呼びます。このtraceを多項式$C(x)$に変換し、

ステートメントが正しい$\leftrightarrow$多項式$C(x)$は多項式$Z(x)$で割り切れる。

という問題に変換します。ここで$Z(x)$は既知の、簡単に計算できる多項式です。この多項式によるステートメントの表現を**AIR**(Arithmetic Intermediate Representation)といいます。

検証者はランダムな値$x$に選び、証明者に送ります。証明者はその$x$に対する$C(x)$の値などを送り返します。この操作を複数繰り返したのち、検証者が「多項式$C(x)$は多項式$Z(x)$で割り切れる」ことに納得したらステートメントを受け入れます。

このように検証者が送信した値に基づいて証明者が値を送り返す証明系のことを**IOP**(Interactive Oracle Proofs)と呼びます。また、検証者が公開のランダムな値を証明者に送るプロトコルを**Public Coin Protocol**といいます。

STARKはこのようにIOPによる対話式証明ですが、public coinなIOPは**Fiat-Shamiar変換**によって、非対話式証明に変換できることが知られています。

## 

